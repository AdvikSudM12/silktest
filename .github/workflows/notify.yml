name: ðŸ“¢ Notifications

on:
  workflow_run:
    workflows: ["ðŸŽ Build macOS App", "ðŸŽ‰ Create Release"]
    types:
      - completed

jobs:
  notify-build-status:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion != 'skipped' }}
    
    steps:
    - name: ðŸ“¥ Get workflow info
      id: workflow_info
      run: |
        echo "workflow_name=${{ github.event.workflow_run.name }}" >> $GITHUB_OUTPUT
        echo "conclusion=${{ github.event.workflow_run.conclusion }}" >> $GITHUB_OUTPUT
        echo "branch=${{ github.event.workflow_run.head_branch }}" >> $GITHUB_OUTPUT
        echo "commit=${{ github.event.workflow_run.head_sha }}" >> $GITHUB_OUTPUT
        echo "run_url=${{ github.event.workflow_run.html_url }}" >> $GITHUB_OUTPUT
        
    - name: ðŸŽ‰ Success notification
      if: ${{ github.event.workflow_run.conclusion == 'success' }}
      run: |
        echo "âœ… ${{ steps.workflow_info.outputs.workflow_name }} Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»ÑÑ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
        echo "ðŸŒ¿ Ð’ÐµÑ‚ÐºÐ°: ${{ steps.workflow_info.outputs.branch }}"
        echo "ðŸ”— ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚: ${{ steps.workflow_info.outputs.commit }}"
        echo "ðŸ“‹ Ð”ÐµÑ‚Ð°Ð»Ð¸: ${{ steps.workflow_info.outputs.run_url }}"
        
        # Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ Ð² Slack/Discord/Telegram
        # ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€:
        # curl -X POST -H 'Content-type: application/json' \
        #   --data '{"text":"âœ… GoSilk Staff build successful!"}' \
        #   $SLACK_WEBHOOK_URL
        
    - name: âŒ Failure notification  
      if: ${{ github.event.workflow_run.conclusion == 'failure' }}
      run: |
        echo "âŒ ${{ steps.workflow_info.outputs.workflow_name }} Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»ÑÑ Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ¾Ð¹!"
        echo "ðŸŒ¿ Ð’ÐµÑ‚ÐºÐ°: ${{ steps.workflow_info.outputs.branch }}"
        echo "ðŸ”— ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚: ${{ steps.workflow_info.outputs.commit }}"
        echo "ðŸ“‹ Ð”ÐµÑ‚Ð°Ð»Ð¸: ${{ steps.workflow_info.outputs.run_url }}"
        
        # Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ
        # curl -X POST -H 'Content-type: application/json' \
        #   --data '{"text":"âŒ GoSilk Staff build failed!"}' \
        #   $SLACK_WEBHOOK_URL
        
    - name: ðŸ“Š Generate summary
      run: |
        cat >> $GITHUB_STEP_SUMMARY << EOF
        # ðŸ“Š Ð¡Ð²Ð¾Ð´ÐºÐ° Ð¿Ð¾ ÑÐ±Ð¾Ñ€ÐºÐµ GoSilk Staff
        
        ## â„¹ï¸ Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ workflow:
        - **ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ:** ${{ steps.workflow_info.outputs.workflow_name }}
        - **Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ${{ steps.workflow_info.outputs.conclusion == 'success' && 'âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾' || 'âŒ ÐžÑˆÐ¸Ð±ÐºÐ°' }}
        - **Ð’ÐµÑ‚ÐºÐ°:** ${{ steps.workflow_info.outputs.branch }}
        - **ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚:** \`${{ steps.workflow_info.outputs.commit }}\`
        
        ## ðŸ”— ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÑÑÑ‹Ð»ÐºÐ¸:
        - [ðŸ“‹ Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ](${{ steps.workflow_info.outputs.run_url }})
        - [ðŸ“¦ Releases](https://github.com/AdvikSudM12/silk/releases)
        - [ðŸ”§ Actions](https://github.com/AdvikSudM12/silk/actions)
        
        EOF 