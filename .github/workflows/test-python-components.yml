name: ðŸ Test Python Components

on:
  push:
    branches: [ main, macos-build-test ]
    paths:
      - 'scripts/**'
      - 'pyqt_app/**'
      - 'requirements.txt'
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-python-components:
    runs-on: macos-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ðŸ”§ Install dependencies
      run: |
        echo "ðŸ”§ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
        python3 -m pip install --upgrade pip
        
        if [ -f "requirements.txt" ]; then
          pip install -r requirements.txt
        fi
        
        if [ -f "pyqt_app/requirements.txt" ]; then
          pip install -r pyqt_app/requirements.txt
        fi
        
        pip install pytest pandas openpyxl xlsxwriter
        
    - name: ðŸ§ª Test Python imports
      run: |
        echo "ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Python Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²..."
        
        python3 -c "
        import sys
        sys.path.append('.')
        
        print('ðŸ“¦ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²...')
        
        try:
            import run_app
            print('âœ… run_app Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½')
        except Exception as e:
            print(f'âŒ run_app: {e}')
        
        try:
            from pyqt_app import env_manager
            print('âœ… env_manager Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½')
        except Exception as e:
            print(f'âŒ env_manager: {e}')
        
        print('ðŸŽ‰ Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ñ‹!')
        "
        
    - name: ðŸ“Š Test data processing
      run: |
        echo "ðŸ“Š Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."
        
        python3 -c "
        import pandas as pd
        import numpy as np
        
        print('ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…...')
        
        data = {
            'ID': range(1, 11),
            'Name': [f'User {i}' for i in range(1, 11)],
            'Score': np.random.randint(1, 100, 10)
        }
        
        df = pd.DataFrame(data)
        
        df.to_csv('test.csv', index=False)
        df.to_excel('test.xlsx', index=False)
        
        print('âœ… Ð¤Ð°Ð¹Ð»Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹')
        
        # Ð§Ñ‚ÐµÐ½Ð¸Ðµ
        df_csv = pd.read_csv('test.csv')
        df_excel = pd.read_excel('test.xlsx')
        
        print(f'âœ… CSV: {len(df_csv)} ÑÑ‚Ñ€Ð¾Ðº')
        print(f'âœ… Excel: {len(df_excel)} ÑÑ‚Ñ€Ð¾Ðº')
        
        print('ðŸŽ‰ ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚!')
        "
        
        rm -f test.csv test.xlsx
        
    - name: ðŸ“‹ Summary
      run: |
        cat >> $GITHUB_STEP_SUMMARY << EOF
        # ðŸ Python Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ âœ…
        
        Ð’ÑÐµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!
        EOF 