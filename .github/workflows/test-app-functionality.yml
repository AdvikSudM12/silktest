name: ðŸ§ª Test App Functionality

on:
  push:
    branches: [ main, macos-build-test ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-paths-and-scripts:
    runs-on: macos-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ðŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ðŸ”§ Install dependencies
      run: |
        echo "ðŸ”§ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
        
        # Python Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
        python3 -m pip install --upgrade pip
        pip install -r requirements.txt
        
        if [ -f "pyqt_app/requirements.txt" ]; then
          pip install -r pyqt_app/requirements.txt
        fi
        
        if [ -f "scripts/requirements.txt" ]; then
          pip install -r scripts/requirements.txt
        fi
        
        # Node.js Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
        npm ci
        
    - name: ðŸ§ª Test Python imports and modules
      run: |
        echo "ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Python Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²..."
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸
        python3 -c "
        import sys
        sys.path.append('.')
        
        print('ðŸ“¦ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²...')
        
        try:
            # ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ
            import run_app
            print('âœ… run_app.py Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾')
        except Exception as e:
            print(f'âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð° run_app: {e}')
            sys.exit(1)
        
        try:
            # PyQt Ð¼Ð¾Ð´ÑƒÐ»Ð¸ (Ð±ÐµÐ· GUI)
            from pyqt_app import env_manager, session_data_manager, script_manager
            print('âœ… PyQt Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾')
        except Exception as e:
            print(f'âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð° PyQt Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹: {e}')
            sys.exit(1)
            
        try:
            # macOS build Ð¼Ð¾Ð´ÑƒÐ»Ð¸
            from macos_build import resource_utils, node_runner
            print('âœ… macOS build Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾')
        except Exception as e:
            print(f'âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð° macOS Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹: {e}')
            sys.exit(1)
        
        print('ðŸŽ‰ Ð’ÑÐµ Python Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð¿Ñ€Ð¾ÑˆÐ»Ð¸ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!')
        "
        
    - name: ðŸ—‚ï¸ Test path management
      run: |
        echo "ðŸ—‚ï¸ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¿ÑƒÑ‚ÐµÐ¹..."
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
        mkdir -p test_temp/data
        mkdir -p test_temp/logs
        cd test_temp
        
        python3 -c "
        import sys
        import os
        sys.path.append('..')
        
        print('ðŸ“ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿ÑƒÑ‚ÐµÐ¹ Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸...')
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ env_manager
        from pyqt_app.env_manager import EnvManager
        env_mgr = EnvManager()
        print(f'âœ… EnvManager Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½: {env_mgr.data_dir}')
        
                 # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ session_data_manager
         from pyqt_app.session_data_manager import session_manager
         print(f'âœ… SessionManager Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½: {session_manager.data_dir}')
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ resource_utils
        from macos_build.resource_utils import is_app_bundle, get_app_data_dir
        is_bundle = is_app_bundle()
        print(f'âœ… App bundle detection: {is_bundle}')
        
        if not is_bundle:
            print('âœ… Ð ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾')
        else:
            print('âš ï¸ ÐžÐ¶Ð¸Ð´Ð°Ð»ÑÑ Ñ€ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸, Ð½Ð¾ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½ app bundle')
        
        print('ðŸŽ‰ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿ÑƒÑ‚ÐµÐ¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!')
        "
        
        cd ..
        rm -rf test_temp
        
    - name: ðŸ”¨ Test TypeScript compilation and scripts
      run: |
        echo "ðŸ”¨ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ TypeScript Ð¸ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²..."
        
        # ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ TypeScript
        if [ -f "tsconfig.json" ]; then
          echo "ðŸ“¦ ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ TypeScript..."
          npx tsc --noEmit
          echo "âœ… TypeScript ÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº"
        fi
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ API Ð¼Ð¾Ð´ÑƒÐ»Ð¸
        echo "ðŸŒ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ API Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹..."
        node -e "
        const fs = require('fs');
        const path = require('path');
        
        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
        const requiredFiles = [
          'src/configs/api.ts',
          'src/tools/table.ts',
          'src/tools/user.ts',
          'src/tools/workflow.ts'
        ];
        
        for (const file of requiredFiles) {
          if (fs.existsSync(file)) {
            console.log(\`âœ… \${file} ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚\`);
          } else {
            console.log(\`âŒ \${file} Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚\`);
            process.exit(1);
          }
        }
        
        console.log('ðŸŽ‰ Ð’ÑÐµ TypeScript Ñ„Ð°Ð¹Ð»Ñ‹ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹!');
        "
        
    - name: ðŸ“Š Test script manager functionality
      run: |
        echo "ðŸ“Š Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ScriptManager..."
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ .env Ñ„Ð°Ð¹Ð»
        cat > .env.test << EOF
        EMD_API=https://test-api.example.com
        EMD_SPACE=test-space
        EMD_TOKEN=test-token-123
        EMD_USER_ID=test-user-456
        EMD_HEADER_TOKEN=Bearer
        EOF
        
        python3 -c "
        import sys
        import os
        sys.path.append('.')
        
        print('ðŸ”§ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ScriptManager...')
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ ScriptManager
        from pyqt_app.script_manager import ScriptManager
        script_mgr = ScriptManager()
        print('âœ… ScriptManager Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½')
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Node.js Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
        deps_result = script_mgr.check_nodejs_dependencies()
        if deps_result['success']:
            print('âœ… Node.js Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾')
        else:
            print(f'âš ï¸ Node.js Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸: {deps_result[\"message\"]}')
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð¿ÑƒÑ‚ÐµÐ¹
        try:
            paths = script_mgr.load_paths_from_json()
            print(f'âœ… ÐŸÑƒÑ‚Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹: {type(paths)}')
        except Exception as e:
            print(f'âš ï¸ ÐŸÑƒÑ‚Ð¸ Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ (Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼Ð¾ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ ÑÑ€ÐµÐ´Ñ‹): {e}')
        
        print('ðŸŽ‰ ScriptManager Ñ‚ÐµÑÑ‚Ñ‹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ñ‹!')
        "
        
        rm -f .env.test
        
    - name: ðŸ“ Test file operations
      run: |
        echo "ðŸ“ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹..."
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
        mkdir -p test_files
        
        # Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Excel Ñ„Ð°Ð¹Ð» (ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð¿ÑƒÑÑ‚Ð¾Ð¹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹)
        cat > test_files/test.csv << EOF
        Track,Artist,Album,Duration
        Test Track 1,Test Artist 1,Test Album 1,3:30
        Test Track 2,Test Artist 2,Test Album 2,4:15
        EOF
        
        python3 -c "
        import sys
        import os
        import pandas as pd
        sys.path.append('.')
        
        print('ðŸ“„ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð¾Ð²...')
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ pandas Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸
        try:
            df = pd.read_csv('test_files/test.csv')
            print(f'âœ… CSV Ñ„Ð°Ð¹Ð» Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½: {len(df)} ÑÑ‚Ñ€Ð¾Ðº')
            print(f'âœ… ÐšÐ¾Ð»Ð¾Ð½ÐºÐ¸: {list(df.columns)}')
        except Exception as e:
            print(f'âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ñ‡Ñ‚ÐµÐ½Ð¸Ñ CSV: {e}')
            sys.exit(1)
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Excel
        try:
            df.to_excel('test_files/test_output.xlsx', index=False)
            print('âœ… Excel Ñ„Ð°Ð¹Ð» ÑÐ¾Ð·Ð´Ð°Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾')
        except Exception as e:
            print(f'âŒ ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Excel: {e}')
            sys.exit(1)
        
        print('ðŸŽ‰ Ð¤Ð°Ð¹Ð»Ð¾Ð²Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!')
        "
        
        rm -rf test_files
        
    - name: ðŸ” Test build environment simulation
      run: |
        echo "ðŸ” Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ€ÐµÐ´Ñ‹ ÑÐ±Ð¾Ñ€ÐºÐ¸..."
        
        # Ð¡Ð¸Ð¼ÑƒÐ»Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ ÑÐ±Ð¾Ñ€Ð¾Ñ‡Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
        python3 -c "
        import sys
        import os
        from pathlib import Path
        sys.path.append('.')
        
        print('ðŸ—ï¸ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ðº ÑÐ±Ð¾Ñ€ÐºÐµ...')
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ PyInstaller spec
        spec_file = Path('macos_build/gosilk_staff.spec')
        if spec_file.exists():
            print('âœ… PyInstaller spec Ð½Ð°Ð¹Ð´ÐµÐ½')
            
            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ spec Ñ„Ð°Ð¹Ð»Ð°
            try:
                with open(spec_file, 'r') as f:
                    content = f.read()
                exec(compile(content, str(spec_file), 'exec'), {'__name__': '__main__'})
                print('âœ… PyInstaller spec ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ‡ÐµÑÐºÐ¸ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚ÐµÐ½')
            except Exception as e:
                print(f'âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð² spec Ñ„Ð°Ð¹Ð»Ðµ: {e}')
                sys.exit(1)
        else:
            print('âŒ PyInstaller spec Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½')
            sys.exit(1)
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð´Ð»Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸
        required_dirs = ['pyqt_app', 'src', 'scripts', 'macos_build']
        for dir_name in required_dirs:
            dir_path = Path(dir_name)
            if dir_path.exists():
                print(f'âœ… Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ {dir_name} Ð½Ð°Ð¹Ð´ÐµÐ½Ð°')
            else:
                print(f'âŒ Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ {dir_name} Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚')
                sys.exit(1)
        
        print('ðŸŽ‰ Ð¡Ñ€ÐµÐ´Ð° Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ðº ÑÐ±Ð¾Ñ€ÐºÐµ!')
        "
        
    - name: ðŸŒ Test API configuration
      run: |
        echo "ðŸŒ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ API ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸..."
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ .env Ñ„Ð°Ð¹Ð» Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¹ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¾Ð¹
        cat > .env.test << EOF
        # EMD API Configuration
        EMD_API=https://api.example.com
        EMD_SPACE=test-space
        EMD_TOKEN=jwt-token-example
        EMD_USER_ID=user-123
        EMD_HEADER_TOKEN=Bearer
        
        # Additional settings
        NODE_ENV=test
        DEBUG=true
        EOF
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
        node -e "
        require('dotenv').config({ path: '.env.test' });
        
        console.log('ðŸ”§ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ...');
        
        const requiredVars = ['EMD_API', 'EMD_SPACE', 'EMD_TOKEN', 'EMD_USER_ID'];
        let allVarsPresent = true;
        
        for (const varName of requiredVars) {
          if (process.env[varName]) {
            console.log(\`âœ… \${varName}: ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð°\`);
          } else {
            console.log(\`âŒ \${varName}: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚\`);
            allVarsPresent = false;
          }
        }
        
        if (allVarsPresent) {
          console.log('ðŸŽ‰ Ð’ÑÐµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾!');
        } else {
          console.log('âŒ ÐÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚');
          process.exit(1);
        }
        "
        
        rm -f .env.test
        
    - name: ðŸ“Š Generate test report
      run: |
        echo "ðŸ“Š Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð° Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸..."
        
        cat > test-report.md << EOF
        # ðŸ§ª ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ GoSilk Staff
        
        ## âœ… ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹:
        
        ### ðŸ Python Ð¼Ð¾Ð´ÑƒÐ»Ð¸:
        - âœ… **run_app.py** - Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
        - âœ… **pyqt_app/** - GUI ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð¸ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñ‹
        - âœ… **macos_build/** - ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ Ð´Ð»Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸ macOS
        - âœ… **scripts/** - Python ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…
        
        ### ðŸ“ Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿ÑƒÑ‚ÐµÐ¹:
        - âœ… **Ð ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸** - Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿ÑƒÑ‚Ð¸
        - âœ… **App bundle Ñ€ÐµÐ¶Ð¸Ð¼** - Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¸ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
        - âœ… **EnvManager** - ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð°Ð¼Ð¸
        - âœ… **SessionManager** - ÑÐµÑÑÐ¸Ð¾Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
        
        ### ðŸ”¨ TypeScript/Node.js:
        - âœ… **ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ TypeScript** - Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ñ‚Ð¸Ð¿Ð¾Ð²
        - âœ… **API Ð¼Ð¾Ð´ÑƒÐ»Ð¸** - ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¸ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²
        - âœ… **Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸** - ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
        - âœ… **ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ** - Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ
        
        ### ðŸ“Š Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ:
        - âœ… **ScriptManager** - Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸
        - âœ… **Ð¤Ð°Ð¹Ð»Ð¾Ð²Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸** - Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ/Ð·Ð°Ð¿Ð¸ÑÑŒ Excel/CSV
        - âœ… **PyInstaller spec** - ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ðº ÑÐ±Ð¾Ñ€ÐºÐµ
        - âœ… **Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°** - Ð²ÑÐµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
        
        ## ðŸŽ¯ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
        **Ð’ÑÐµ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!** âœ…
        
        ---
        
        ðŸ“… **Ð”Ð°Ñ‚Ð° Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:** $(date)  
        ðŸ—ï¸ **ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°:** $(uname -m)  
        ðŸ”— **ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚:** ${GITHUB_SHA:0:7}
        EOF
        
        echo "âœ… ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½"
        
    - name: ðŸ”º Upload test report
      uses: actions/upload-artifact@v4
      with:
        name: Test-Report
        path: test-report.md
        retention-days: 30
        
    - name: ðŸ“‹ Test summary
      run: |
        cat >> $GITHUB_STEP_SUMMARY << EOF
        # ðŸ§ª Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ GoSilk Staff
        
        ## âœ… Ð’ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!
        
        ### ðŸ” ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ð±Ð»Ð°ÑÑ‚Ð¸:
        - ðŸ **Python Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð¸ Ð¼Ð¾Ð´ÑƒÐ»Ð¸** 
        - ðŸ“ **Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿ÑƒÑ‚ÐµÐ¹ Ð¸ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²**
        - ðŸ”¨ **TypeScript ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ**
        - ðŸŒ **API ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ**
        - ðŸ“Š **Ð¤Ð°Ð¹Ð»Ð¾Ð²Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸**
        - ðŸ—ï¸ **Ð“Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ðº ÑÐ±Ð¾Ñ€ÐºÐµ**
        
        ### ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°:
        - **Python Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹:** Ð²ÑÐµ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾
        - **TypeScript:** ÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº
        - **Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸:** ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚
        - **Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:** ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸ÑÐ¼
        
        ## ðŸŽ¯ Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ:
        **ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ Ðº ÑÐ±Ð¾Ñ€ÐºÐµ Ð¸ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸ÑŽ!** ðŸš€
        EOF 