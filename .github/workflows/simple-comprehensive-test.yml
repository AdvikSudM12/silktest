name: ðŸ§ª Simple Comprehensive Test

on:
  push:
    branches: [ main, macos-build-test ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-imports:
    runs-on: macos-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ðŸ”§ Install dependencies
      run: |
        python3 -m pip install --upgrade pip
        pip install -r requirements.txt || echo "âš ï¸ requirements.txt Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
        if [ -f "pyqt_app/requirements.txt" ]; then
          pip install -r pyqt_app/requirements.txt
        fi
        pip install pytest pandas openpyxl xlsxwriter
        
    - name: ðŸ§ª Test Python imports
      run: |
        echo "ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²..."
        python3 -c "import run_app; print('âœ… run_app')" || echo "âŒ run_app failed"
        python3 -c "from pyqt_app import env_manager; print('âœ… env_manager')" || echo "âŒ env_manager failed"
        python3 -c "from pyqt_app import session_data_manager; print('âœ… session_data_manager')" || echo "âŒ session_data_manager failed"
        python3 -c "from pyqt_app import script_manager; print('âœ… script_manager')" || echo "âŒ script_manager failed"
        python3 -c "from macos_build import resource_utils; print('âœ… resource_utils')" || echo "âŒ resource_utils failed"
        python3 -c "from macos_build import node_runner; print('âœ… node_runner')" || echo "âŒ node_runner failed"
        echo "ðŸŽ‰ Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ñ‹!"
        
    - name: ðŸ—‚ï¸ Test paths
      run: |
        echo "ðŸ—‚ï¸ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿ÑƒÑ‚ÐµÐ¹..."
        python3 -c "from macos_build.resource_utils import is_app_bundle; print(f'âœ… App bundle: {is_app_bundle()}')" || echo "âŒ path test failed"
        echo "ðŸŽ‰ ÐŸÑƒÑ‚Ð¸ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹!"
        
    - name: ðŸ“‹ Test managers
      run: |
        echo "ðŸ“‹ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð²..."
        python3 -c "from pyqt_app.script_manager import ScriptManager; ScriptManager(); print('âœ… ScriptManager')" || echo "âŒ ScriptManager failed"
        python3 -c "from pyqt_app.env_manager import EnvManager; EnvManager(); print('âœ… EnvManager')" || echo "âŒ EnvManager failed"
        echo "ðŸŽ‰ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñ‹ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹!"
        
    - name: ðŸ“Š Test data processing
      run: |
        echo "ðŸ“Š Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."
        python3 -c "
        import pandas as pd
        import numpy as np
        data = {'ID': range(1, 6), 'Value': np.random.randint(1, 100, 5)}
        df = pd.DataFrame(data)
        df.to_csv('test.csv', index=False)
        df.to_excel('test.xlsx', index=False)
        print('âœ… Ð¤Ð°Ð¹Ð»Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹')
        df2 = pd.read_csv('test.csv')
        df3 = pd.read_excel('test.xlsx')
        print('âœ… Ð¤Ð°Ð¹Ð»Ñ‹ Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ñ‹')
        import os
        os.remove('test.csv')
        os.remove('test.xlsx')
        print('âœ… ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°')
        "
        echo "ðŸŽ‰ Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹!"
        
    - name: ðŸ“‹ Generate summary
      run: |
        cat >> $GITHUB_STEP_SUMMARY << EOF
        # ðŸ§ª ÐŸÑ€Ð¾ÑÑ‚Ð¾Ðµ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ð¾Ðµ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ âœ…
        
        ## ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾:
        - âœ… **Python Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹** - Ð²ÑÐµ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸
        - âœ… **Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿ÑƒÑ‚ÐµÐ¹** - Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ñ€ÐµÐ¶Ð¸Ð¼Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
        - âœ… **ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñ‹** - ScriptManager Ð¸ EnvManager
        - âœ… **ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…** - pandas Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸
        
        ## Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
        **Ð’ÑÐµ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾!** ðŸš€
        EOF 