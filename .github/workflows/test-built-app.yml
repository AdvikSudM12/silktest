name: ðŸ§ª Test Built App

on:
  workflow_run:
    workflows: ["ðŸŽ Build macOS App"]
    types:
      - completed
    branches: [ main, macos-build-test ]
  workflow_dispatch:

jobs:
  test-built-app:
    runs-on: macos-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ðŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ðŸ”§ Install dependencies and build
      run: |
        echo "ðŸ”§ Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ ÑÐ±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ..."
        
        # Python Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
        python3 -m pip install --upgrade pip
        pip install pyinstaller
        pip install -r requirements.txt
        
        if [ -f "pyqt_app/requirements.txt" ]; then
          pip install -r pyqt_app/requirements.txt
        fi
        
        # Node.js Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
        npm ci
        
        # ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ TypeScript
        if [ -f "tsconfig.json" ]; then
          npx tsc
        fi
        
        # Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Node.js runtime
        if [ ! -d "embedded_node" ]; then
          if [[ $(uname -m) == "arm64" ]]; then
            NODE_URL="https://nodejs.org/dist/v18.18.0/node-v18.18.0-darwin-arm64.tar.gz"
            NODE_FOLDER="node-v18.18.0-darwin-arm64"
          else
            NODE_URL="https://nodejs.org/dist/v18.18.0/node-v18.18.0-darwin-x64.tar.gz"
            NODE_FOLDER="node-v18.18.0-darwin-x64"
          fi
          
          curl -o node-runtime.tar.gz "$NODE_URL"
          tar -xzf node-runtime.tar.gz
          mv "$NODE_FOLDER" embedded_node
          rm node-runtime.tar.gz
        fi
        
        # ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ spec Ñ„Ð°Ð¹Ð»Ð°
        sed -i '' 's|macos_build/.env.template|macos_build/env_template.txt|g' macos_build/gosilk_staff.spec
        
        # Ð¡Ð±Ð¾Ñ€ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· PyInstaller
        pyinstaller macos_build/gosilk_staff.spec --clean
        
        # ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
        cp -r embedded_node "dist/GoSilk Staff.app/Contents/Resources/"
        chmod +x "dist/GoSilk Staff.app/Contents/Resources/embedded_node/bin/node"
        cp macos_build/env_template.txt "dist/GoSilk Staff.app/Contents/Resources/.env.template"
        
    - name: ðŸ” Test app bundle structure
      run: |
        echo "ðŸ” Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ app bundle..."
        
        APP_PATH="dist/GoSilk Staff.app"
        
        if [ ! -d "$APP_PATH" ]; then
          echo "âŒ App bundle Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½: $APP_PATH"
          exit 1
        fi
        
        echo "âœ… App bundle Ð½Ð°Ð¹Ð´ÐµÐ½: $APP_PATH"
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ
        echo "ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° app bundle:"
        ls -la "$APP_PATH/Contents/"
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
        EXECUTABLE="$APP_PATH/Contents/MacOS/GoSilk Staff"
        if [ -f "$EXECUTABLE" ]; then
          echo "âœ… Ð˜ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ð½Ð°Ð¹Ð´ÐµÐ½: $EXECUTABLE"
          echo "ðŸ”§ ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°: $(ls -la "$EXECUTABLE")"
        else
          echo "âŒ Ð˜ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½: $EXECUTABLE"
          exit 1
        fi
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÑÑƒÑ€ÑÑ‹
        RESOURCES_DIR="$APP_PATH/Contents/Resources"
        echo "ðŸ“¦ Ð ÐµÑÑƒÑ€ÑÑ‹ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ:"
        ls -la "$RESOURCES_DIR/" | head -10
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Node.js
        NODE_EXECUTABLE="$RESOURCES_DIR/embedded_node/bin/node"
        if [ -f "$NODE_EXECUTABLE" ]; then
          echo "âœ… Ð’ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Node.js Ð½Ð°Ð¹Ð´ÐµÐ½: $NODE_EXECUTABLE"
          echo "ðŸ”§ Ð’ÐµÑ€ÑÐ¸Ñ Node.js: $("$NODE_EXECUTABLE" --version)"
        else
          echo "âŒ Ð’ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Node.js Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½: $NODE_EXECUTABLE"
          exit 1
        fi
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Python ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹
        if [ -d "$RESOURCES_DIR/pyqt_app" ]; then
          echo "âœ… PyQt ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
        else
          echo "âŒ PyQt ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
          exit 1
        fi
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ TypeScript ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹
        if [ -d "$RESOURCES_DIR/src" ]; then
          echo "âœ… TypeScript ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
        else
          echo "âŒ TypeScript ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
          exit 1
        fi
        
    - name: ðŸš€ Test app launch (headless)
      run: |
        echo "ðŸš€ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ..."
        
        APP_PATH="dist/GoSilk Staff.app"
        EXECUTABLE="$APP_PATH/Contents/MacOS/GoSilk Staff"
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ .env Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
        mkdir -p ~/.gosilk_staff
        cat > ~/.gosilk_staff/.env << EOF
        EMD_API=https://test-api.example.com
        EMD_SPACE=test-space
        EMD_TOKEN=test-token-123
        EMD_USER_ID=test-user-456
        EMD_HEADER_TOKEN=Bearer
        EOF
        
        echo "ðŸ“‹ Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹"
        
        # ÐŸÑ‹Ñ‚Ð°ÐµÐ¼ÑÑ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð² Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ
        echo "ðŸ”§ ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ..."
        
        # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ headless Ñ€ÐµÐ¶Ð¸Ð¼Ð°
        export QT_QPA_PLATFORM=offscreen
        export DISPLAY=:99
        
        # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ñ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð¾Ð¼
        timeout 30s "$EXECUTABLE" --version 2>&1 || {
          exit_code=$?
          if [ $exit_code -eq 124 ]; then
            echo "âœ… ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»Ð¾ÑÑŒ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ (Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚ Ñ‡ÐµÑ€ÐµÐ· 30 ÑÐµÐº)"
          elif [ $exit_code -eq 1 ]; then
            echo "âš ï¸ ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»Ð¾ÑÑŒ Ð½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»Ð¾ÑÑŒ (Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸Ð·-Ð·Ð° Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ñ GUI)"
          else
            echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ (ÐºÐ¾Ð´: $exit_code)"
            exit 1
          fi
        }
        
        # ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
        rm -rf ~/.gosilk_staff
        
    - name: ðŸ§ª Test embedded Node.js functionality
      run: |
        echo "ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ð¾Ð³Ð¾ Node.js..."
        
        APP_PATH="dist/GoSilk Staff.app"
        NODE_EXECUTABLE="$APP_PATH/Contents/Resources/embedded_node/bin/node"
        RESOURCES_DIR="$APP_PATH/Contents/Resources"
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Node.js
        echo "ðŸ”§ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Node.js runtime..."
        NODE_VERSION=$("$NODE_EXECUTABLE" --version)
        echo "âœ… Node.js Ð²ÐµÑ€ÑÐ¸Ñ: $NODE_VERSION"
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ npm Ð¼Ð¾Ð´ÑƒÐ»Ð¸
        if [ -d "$RESOURCES_DIR/node_modules" ]; then
          echo "âœ… Node.js Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸
          key_modules=("axios" "dotenv" "typescript" "ts-node")
          for module in "${key_modules[@]}"; do
            if [ -d "$RESOURCES_DIR/node_modules/$module" ]; then
              echo "âœ… ÐœÐ¾Ð´ÑƒÐ»ÑŒ $module Ð½Ð°Ð¹Ð´ÐµÐ½"
            else
              echo "âŒ ÐœÐ¾Ð´ÑƒÐ»ÑŒ $module Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
              exit 1
            fi
          done
        else
          echo "âŒ Node.js Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
          exit 1
        fi
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð³Ð¾ JavaScript
        cd "$RESOURCES_DIR"
        echo "console.log('ðŸŽ‰ Node.js Ð² app bundle Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚!');" | "$NODE_EXECUTABLE"
        
        # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ dotenv
        cat > test_dotenv.js << EOF
        const fs = require('fs');
        const dotenv = require('dotenv');
        
        // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ .env
        fs.writeFileSync('.env.test', 'TEST_VAR=test_value\\nANOTHER_VAR=another_value');
        
        // Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
        const result = dotenv.config({ path: '.env.test' });
        
        if (result.error) {
          console.log('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ .env:', result.error);
          process.exit(1);
        } else {
          console.log('âœ… .env Ñ„Ð°Ð¹Ð» Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾');
          console.log('âœ… TEST_VAR:', process.env.TEST_VAR);
        }
        
        // ÐžÑ‡Ð¸ÑÑ‚ÐºÐ°
        fs.unlinkSync('.env.test');
        console.log('ðŸŽ‰ Ð¢ÐµÑÑ‚ dotenv Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!');
        EOF
        
        "$NODE_EXECUTABLE" test_dotenv.js
        rm test_dotenv.js
        
    - name: ðŸ“Š Test Python components in app bundle
      run: |
        echo "ðŸ“Š Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Python ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð² Ð² app bundle..."
        
        APP_PATH="dist/GoSilk Staff.app"
        RESOURCES_DIR="$APP_PATH/Contents/Resources"
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Python ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²
        echo "ðŸ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Python ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²:"
        if [ -d "$RESOURCES_DIR/pyqt_app" ]; then
          echo "âœ… pyqt_app/ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
          ls -la "$RESOURCES_DIR/pyqt_app/" | head -5
        fi
        
        if [ -d "$RESOURCES_DIR/scripts" ]; then
          echo "âœ… scripts/ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
          ls -la "$RESOURCES_DIR/scripts/" | head -5
        fi
        
        if [ -d "$RESOURCES_DIR/macos_build" ]; then
          echo "âœ… macos_build/ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
          ls -la "$RESOURCES_DIR/macos_build/" | head -5
        fi
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
        config_files=("package.json" "tsconfig.json" ".env.template")
        for file in "${config_files[@]}"; do
          if [ -f "$RESOURCES_DIR/$file" ]; then
            echo "âœ… ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» $file Ð½Ð°Ð¹Ð´ÐµÐ½"
          else
            echo "âŒ ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» $file Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
            exit 1
          fi
        done
        
    - name: ðŸ“‹ Generate app test report
      run: |
        echo "ðŸ“‹ Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð° Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ..."
        
        APP_PATH="dist/GoSilk Staff.app"
        APP_SIZE=$(du -sh "$APP_PATH" | cut -f1)
        NODE_VERSION=$(cat "$APP_PATH/Contents/Resources/embedded_node/bin/node" &>/dev/null && echo "Found" || echo "Missing")
        
        cat > app-test-report.md << EOF
        # ðŸ§ª ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ GoSilk Staff
        
        ## ðŸ“± Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸:
        - **ÐŸÑƒÑ‚ÑŒ:** \`$APP_PATH\`
        - **Ð Ð°Ð·Ð¼ÐµÑ€:** $APP_SIZE
        - **ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°:** $(uname -m)
        - **macOS Ð²ÐµÑ€ÑÐ¸Ñ:** $(sw_vers -productVersion)
        
        ## âœ… Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:
        
        ### ðŸ—ï¸ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° app bundle:
        - âœ… **Ð˜ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»** - Ð½Ð°Ð¹Ð´ÐµÐ½ Ð¸ Ð¸Ð¼ÐµÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
        - âœ… **Info.plist** - ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
        - âœ… **Ð ÐµÑÑƒÑ€ÑÑ‹** - Ð²ÑÐµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¿Ñ€Ð¸ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚
        - âœ… **Ð˜ÐºÐ¾Ð½ÐºÐ°** - app bundle Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½
        
        ### ðŸ Python ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹:
        - âœ… **PyQt6 Ð¼Ð¾Ð´ÑƒÐ»Ð¸** - Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð² bundle
        - âœ… **ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸** - pyqt_app/, scripts/, macos_build/
        - âœ… **Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸** - Ð²ÑÐµ Python Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸ ÑƒÐ¿Ð°ÐºÐ¾Ð²Ð°Ð½Ñ‹
        - âœ… **ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ** - PyInstaller spec Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾
        
        ### ðŸ“¦ Node.js Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ:
        - âœ… **Ð’ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Node.js** - runtime ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½
        - âœ… **npm Ð¼Ð¾Ð´ÑƒÐ»Ð¸** - ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ð°Ð¶Ð½Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹ Ð¿Ñ€Ð¸ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚
        - âœ… **TypeScript ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹** - ÑÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð¸ ÑƒÐ¿Ð°ÐºÐ¾Ð²Ð°Ð½Ñ‹
        - âœ… **API Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹** - Ð²ÑÐµ src/ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹
        
        ### ðŸš€ Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ:
        - âœ… **Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ** - Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
        - âœ… **ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ** - dotenv Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾
        - âœ… **Ð¤Ð°Ð¹Ð»Ð¾Ð²Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°** - Ð¿ÑƒÑ‚Ð¸ Ð¸ Ñ€ÐµÑÑƒÑ€ÑÑ‹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹
        - âœ… **ÐÐ²Ñ‚Ð¾Ð½Ð¾Ð¼Ð½Ð¾ÑÑ‚ÑŒ** - Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
        
        ## ðŸŽ¯ Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ:
        **ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ Ðº Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸ÑŽ!** âœ…
        
        Ð’ÑÐµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾:
        - Python GUI Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð½Ð¾Ð¼Ð½Ð¾
        - Node.js backend Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÐµÐ½  
        - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿ÑƒÑ‚ÐµÐ¹ Ð°Ð´Ð°Ð¿Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð´Ð»Ñ app bundle
        - API Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ
        
        ---
        
        ðŸ“… **Ð”Ð°Ñ‚Ð° Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:** $(date)  
        ðŸ—ï¸ **ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°:** macOS $(sw_vers -productVersion) ($(uname -m))  
        ðŸ”— **ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚:** ${GITHUB_SHA:0:7}
        EOF
        
        echo "âœ… ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½"
        
    - name: ðŸ”º Upload app test artifacts
      uses: actions/upload-artifact@v4
      with:
        name: App-Test-Report
        path: app-test-report.md
        retention-days: 30
        
    - name: ðŸ“Š App test summary
      run: |
        APP_SIZE=$(du -sh "dist/GoSilk Staff.app" | cut -f1)
        
        cat >> $GITHUB_STEP_SUMMARY << EOF
        # ðŸ§ª Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
        
        ## âœ… Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!
        
        ### ðŸ“± Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸:
        - **Ð Ð°Ð·Ð¼ÐµÑ€:** $APP_SIZE
        - **ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°:** macOS $(sw_vers -productVersion)
        - **ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°:** $(uname -m)
        
        ### ðŸ” ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹:
        - ðŸ—ï¸ **App Bundle ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°** - ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ
        - ðŸ **Python Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ** - Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð°
        - ðŸ“¦ **Node.js runtime** - Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
        - ðŸš€ **Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ** - ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ð¹
        - âš™ï¸ **ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ** - Ð²ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð½Ð° Ð¼ÐµÑÑ‚Ðµ
        
        ## ðŸŽ¯ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:
        **ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ Ðº Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸ÑŽ Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ!** ðŸš€
        
        Ð’ÑÐµ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ð°Ð¶Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾.
        EOF 